# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã –º–æ–¥–µ–ª–µ–π DeepSeek –∏ OpenAI

**–î–∞—Ç–∞:** 1 –Ω–æ—è–±—Ä—è 2025  
**–ü—Ä–æ–±–ª–µ–º–∞:** DeepSeek –∞–Ω–∞–ª–∏–∑ —Å—Ä–∞–∑—É –∑–∞–≤–µ—Ä—à–∞–ª—Å—è —Å –æ—à–∏–±–∫–æ–π –±–µ–∑ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è

## –í—ã—è–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª—è `provider` –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –º–æ–¥–µ–ª–µ–π**
   - –í `index/models.json` –Ω–µ –±—ã–ª–æ —è–≤–Ω–æ–≥–æ —É–∫–∞–∑–∞–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
   - –ö–æ–¥ –æ–ø—Ä–µ–¥–µ–ª—è–ª –ø—Ä–æ–≤–∞–π–¥–µ—Ä –ø–æ –ø—Ä–µ—Ñ–∏–∫—Å—É `model_id`, –Ω–æ —Ç–µ—Å—Ç—ã —Ç—Ä–µ–±–æ–≤–∞–ª–∏ —è–≤–Ω–æ–µ –ø–æ–ª–µ

2. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ API**
   - –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ API –Ω–µ –≤—ã–≤–æ–¥–∏–ª–∏—Å—å –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è
   - –°–ª–æ–∂–Ω–æ –±—ã–ª–æ –¥–∏–∞–≥–Ω–æ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—É

3. **–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ç–µ—Å—Ç –¥–ª—è DeepSeek Reasoner**
   - –¢–µ—Å—Ç –æ–∂–∏–¥–∞–ª —Ç–µ–∫—Å—Ç –≤ –ø–æ–ª–µ `content`
   - DeepSeek Reasoner –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ `reasoning_content`

## –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–¥–µ–ª–µ–π (`index/models.json`)

–î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π:

**OpenAI –º–æ–¥–µ–ª–∏:**
```json
{
  "model_id": "gpt-4o",
  "provider": "openai",
  ...
}
```

**DeepSeek –º–æ–¥–µ–ª–∏:**
```json
{
  "model_id": "deepseek-chat",
  "provider": "deepseek",
  "base_url": "https://api.deepseek.com",
  ...
}
```

### 2. –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (`webapp/routes/ai_rag.py`)

–î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫ API:
```python
except Exception as api_err:
    error_str = str(api_err)
    current_app.logger.error(f'–û—à–∏–±–∫–∞ API {model_id}: {error_str}', exc_info=True)
```

–í —Ñ—É–Ω–∫—Ü–∏—é `_get_api_client()` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å—Ç–∞—Ç—É—Å–µ –∫–ª—é—á–∞:
```python
current_app.logger.info(f'–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è DeepSeek API –¥–ª—è –º–æ–¥–µ–ª–∏ {model_id}, –∫–ª—é—á: {"–ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç" if deepseek_key and len(deepseek_key) > 10 else "–û–¢–°–£–¢–°–¢–í–£–ï–¢!"}')
```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç DeepSeek Reasoner (`tests/test_deepseek_api.py`)

–¢–µ–ø–µ—Ä—å –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –æ–±–∞ –ø–æ–ª—è:
```python
message_content = message.content or ""
reasoning_content = getattr(message, 'reasoning_content', None) or ""

# –•–æ—Ç—è –±—ã –æ–¥–Ω–æ –∏–∑ –ø–æ–ª–µ–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–æ
assert (message_content or reasoning_content), "–û–±–∞ –ø–æ–ª—è –ø—É—Å—Ç—ã–µ"
```

### 4. –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è `provider` –¥–ª—è UX

–û–±–Ω–æ–≤–ª–µ–Ω—ã –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `static/js/rag-analysis.js`:
- **–ó–µ–ª–µ–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ** (‚â§5% –±–∏—Ç—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤): `‚úÖ 2.1% –±–∏—Ç—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è`
- **–ñ–µ–ª—Ç–æ–µ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ** (>5%): `‚ö†Ô∏è 15.3% –±–∏—Ç—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è!`

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### DeepSeek API
```bash
$ pytest tests/test_deepseek_api.py -v
‚úÖ test_deepseek_api_key_exists PASSED
‚úÖ test_deepseek_chat_connection PASSED
‚úÖ test_deepseek_reasoner_connection PASSED
‚úÖ test_deepseek_api_with_timeout PASSED
‚úÖ test_deepseek_models_in_config PASSED

5 passed in 10.87s
```

### OpenAI API
```bash
$ pytest tests/test_openai_api.py -v
‚úÖ test_openai_api_key_exists PASSED
‚úÖ test_openai_connection PASSED
‚úÖ test_openai_models_in_config PASSED

3 passed in 2.27s
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π

**DeepSeek:**
```
üîë DeepSeek –∫–ª—é—á –Ω–∞–π–¥–µ–Ω: sk-ea785...
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!
üìù –û—Ç–≤–µ—Ç: –ü—Ä–∏–≤–µ—Ç! (Privet!)
üìä –¢–æ–∫–µ–Ω—ã: input=13, output=7
```

**OpenAI:**
```
üîë OpenAI –∫–ª—é—á –Ω–∞–π–¥–µ–Ω: sk-proj-...
‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ!
üìù –û—Ç–≤–µ—Ç: –ü—Ä–∏–≤–µ—Ç! (Privet!)
üìä –¢–æ–∫–µ–Ω—ã: input=20, output=8
```

## –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ê–∫—Ç–∏–≤–Ω—ã–µ –º–æ–¥–µ–ª–∏ (6 —à—Ç.)
| –ú–æ–¥–µ–ª—å | –ü—Ä–æ–≤–∞–π–¥–µ—Ä | –°—Ç–∞—Ç—É—Å | –¶–µ–Ω–∞ (input/output per 1M) |
|--------|-----------|--------|---------------------------|
| gpt-4o | openai | ‚úÖ | $2.5 / $10.0 |
| gpt-4o-mini | openai | ‚úÖ | $0.15 / $0.6 |
| o1 | openai | ‚úÖ | $15.0 / $60.0 |
| gpt-3.5-turbo | openai | ‚úÖ | $0.5 / $1.5 |
| deepseek-chat | openai | ‚úÖ | $0.028 / $0.42 |
| deepseek-reasoner | deepseek | ‚úÖ | $0.028 / $0.42 |

**–ú–æ–¥–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é:** `deepseek-chat`

### API –∫–ª—é—á–∏
- ‚úÖ **DeepSeek:** `sk-e...3171` (–∞–∫—Ç–∏–≤–µ–Ω)
- ‚úÖ **OpenAI:** `sk-p...jEYA` (–∞–∫—Ç–∏–≤–µ–Ω)

## –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å

1. **–û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:** `http://localhost:8081`
2. **–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å** –≤ –æ–∫–Ω–µ "AI –∞–Ω–∞–ª–∏–∑"
3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–Ω–∞–ª–∏–∑** - —Ç–µ–ø–µ—Ä—å –æ–±–µ –º–æ–¥–µ–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

## –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø—Ä–æ–±–ª–µ–º

–ï—Å–ª–∏ –∞–Ω–∞–ª–∏–∑ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **API –∫–ª—é—á–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã:**
   ```bash
   python3 -c "from utils.api_keys_manager import get_api_keys_manager; print(get_api_keys_manager().list_keys())"
   ```

2. **–õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   ```bash
   tail -f logs/app.log | grep -i "deepseek\|error\|api"
   ```

3. **–°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–µ—Ä–∞:**
   ```bash
   curl http://localhost:8081/health
   ```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

- [ ] –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é API –∫–ª—é—á–µ–π –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∫–ª—é—á–µ–π
- [ ] –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞—Å—Ö–æ–¥–∞ —Ç–æ–∫–µ–Ω–æ–≤ –ø–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º
- [ ] –°–æ–∑–¥–∞—Ç—å UI –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞–º–∏

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ  
**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:** DeepSeek Chat, DeepSeek Reasoner, GPT-4o-mini, GPT-3.5-turbo
