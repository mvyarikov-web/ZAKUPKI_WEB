# –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—é –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤–µ–±-–ø–æ–∏—Å–∫–∞ Perplexity

## –ö–æ–º–º–∏—Ç
- **–•–µ—à**: `72038c5`
- **–î–∞—Ç–∞**: 2 –Ω–æ—è–±—Ä—è 2025 –≥.
- **–°–æ–æ–±—â–µ–Ω–∏–µ**: fix: –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–¥–∞—á–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–æ–∏—Å–∫–∞ Perplexity —á–µ—Ä–µ–∑ extra_body

## –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### –ü—Ä–æ–±–ª–µ–º–∞
OpenAI SDK –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `extra_json`, –∫–æ—Ç–æ—Ä—ã–µ **–∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è** API. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ Perplexity –Ω–µ –ø–µ—Ä–µ–¥–∞–≤–∞–ª–∏—Å—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ, –∏ –º–æ–¥–µ–ª—å –Ω–µ –≤—ã–ø–æ–ª–Ω—è–ª–∞ –≤–µ–±-–ø–æ–∏—Å–∫.

### –†–µ—à–µ–Ω–∏–µ
–í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ Perplexity —Ç–µ–ø–µ—Ä—å **—è–≤–Ω–æ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ `extra_body`**:

```python
# –ë—ã–ª–æ (–Ω–µ —Ä–∞–±–æ—Ç–∞–ª–æ):
request_params["enable_search_classifier"] = True
request_params["search_mode"] = "web"

# –°—Ç–∞–ª–æ (—Ä–∞–±–æ—Ç–∞–µ—Ç):
request_params["extra_body"] = {
    "enable_search_classifier": True,
    "search_mode": "web",
    "language_preference": "ru",
    "web_search_options": {"search_context_size": "low"}
}
```

## –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä

```bash
cd /Users/maksimyarikov/Desktop/–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è\ –∑–∞–∫—É–ø–æ–∫/–ö–æ–¥/web_interface
lsof -ti:8081 | xargs kill -9 2>/dev/null
.venv/bin/python restart_server.py
```

–ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–Ω–æ–ø–∫—É "Restart Server" –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ (–µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç).

### 2. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ `http://localhost:8081`

### 3. –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å –ø–æ–∏—Å–∫–æ–º

1. **–í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å**: `sonar` –∏–ª–∏ `sonar-pro` (–Ω–µ `perplexity-search-api`!)
2. **–í–∫–ª—é—á–∏—Ç–µ –≥–∞–ª–∫—É "Search"** (–∏–ª–∏ "–ü–æ–∏—Å–∫")
3. **–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª(—ã)** –∏–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ –ø—É—Å—Ç—ã–º
4. **–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–ø—Ç**, —Ç—Ä–µ–±—É—é—â–∏–π –∞–∫—Ç—É–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä:
   - "–ö–∞–∫–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ 44-–§–ó –ø–æ –∑–∞–∫—É–ø–∫–∞–º –≤ 2025 –≥–æ–¥—É?"
   - "–ù–∞–π–¥–∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–∞–∑—ä—è—Å–Ω–µ–Ω–∏—è –§–ê–° –ø–æ –º–æ–Ω—Ç–∞–∂—É –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è"
   - "–ö–∞–∫–∞—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Å–ø–ª–∏—Ç-—Å–∏—Å—Ç–µ–º–∞—Ö –Ω–∞ zakupki.gov.ru?"
5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∞–Ω–∞–ª–∏–∑**

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏

–û—Ç–∫—Ä–æ–π—Ç–µ —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:

```bash
tail -f logs/app.log | grep -E "(üåê|üîç|‚úÖ|üîó|extra_body)"
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–º –ø–æ–∏—Å–∫–µ:**

```
üåê –†–µ–∂–∏–º –° –ü–û–ò–°–ö–û–ú: extra_body = {'enable_search_classifier': True, 'search_mode': 'web', 'language_preference': 'ru', 'web_search_options': {'search_context_size': 'low'}}
üîç Search usage: num_search_queries=3, search_context_size=1234
‚úÖ –ü–æ–∏—Å–∫ –ë–´–õ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω
üîó –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –ø–æ–∏—Å–∫–∞ (3 –≤—Å–µ–≥–æ): Example Title (https://example.com); ...
```

**–û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–º –ø–æ–∏—Å–∫–µ:**

```
üö´ –†–µ–∂–∏–º –ë–ï–ó –ü–û–ò–°–ö–ê: extra_body = {'disable_search': True}
üìù –ü–æ–∏—Å–∫ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω (—Ç–æ–ª—å–∫–æ –∑–Ω–∞–Ω–∏—è –º–æ–¥–µ–ª–∏)
```

### 5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ

–í –æ—Ç–≤–µ—Ç–µ –º–æ–¥–µ–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å:
- –°—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ (–µ—Å–ª–∏ –ø–æ–∏—Å–∫ —Å—Ä–∞–±–æ—Ç–∞–ª)
- –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞
- –í –Ω–∞–∑–≤–∞–Ω–∏–∏ –º–æ–¥–µ–ª–∏ —Å—É—Ñ—Ñ–∏–∫—Å "+ Search" (–Ω–∞–ø—Ä–∏–º–µ—Ä, "sonar + Search")

### 6. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–û—Ç–∫—Ä–æ–π—Ç–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–π —Ñ–∞–π–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ (`.md` –∏–ª–∏ `.txt`):
- –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —É–∫–∞–∑–∞–Ω–æ: **"–ú–æ–¥–µ–ª—å: sonar + Search"**
- –î–æ–ª–∂–Ω—ã –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –≤ —Ä–∞–∑–¥–µ–ª–µ "–ò—Å—Ç–æ—á–Ω–∏–∫–∏"

## –¢–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–∏—Å–∫ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π –ø–æ –¥–æ–º–µ–Ω—É

1. –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å `sonar-pro`
2. –í–∫–ª—é—á–∏—Ç–µ "Search"
3. –í –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –ø–æ–∏—Å–∫–∞ —É–∫–∞–∂–∏—Ç–µ:
   - Domain filter: `zakupki.gov.ru, fas.gov.ru`
   - Recency: `month`
4. –ü—Ä–æ–º–ø—Ç: "–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ 44-–§–ó"
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö –Ω–∞–ª–∏—á–∏–µ `search_domain_filter` –≤ `extra_body`

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ë–µ–∑ –ø–æ–∏—Å–∫–∞ (–æ—Ñ–ª–∞–π–Ω-—Ä–µ–∂–∏–º)

1. –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å `sonar`
2. **–û—Ç–∫–ª—é—á–∏—Ç–µ** –≥–∞–ª–∫—É "Search"
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç
4. –ü—Ä–æ–º–ø—Ç: "–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç"
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ –ª–æ–≥–∞—Ö: `üö´ –†–µ–∂–∏–º –ë–ï–ó –ü–û–ò–°–ö–ê: extra_body = {'disable_search': True}`

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –ü–æ–∏—Å–∫ –±–µ–∑ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

1. –í—ã–±–µ—Ä–∏—Ç–µ –º–æ–¥–µ–ª—å `sonar`
2. –í–∫–ª—é—á–∏—Ç–µ "Search"
3. **–ù–ï –∑–∞–≥—Ä—É–∂–∞–π—Ç–µ** –¥–æ–∫—É–º–µ–Ω—Ç—ã
4. –ü—Ä–æ–º–ø—Ç: "–ö–∞–∫–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –ø–æ –≥–æ—Å—É–¥–∞—Ä—Å—Ç–≤–µ–Ω–Ω—ã–º –∑–∞–∫—É–ø–∫–∞–º?"
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–æ–¥–µ–ª—å –≤–µ—Ä–Ω—É–ª–∞ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Å —Å—Å—ã–ª–∫–∞–º–∏

## –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö

### –û—à–∏–±–∫–∞: "–Ø –Ω–µ –º–æ–≥—É –∑–∞–π—Ç–∏ –Ω–∞ —Å–∞–π—Ç—ã..."

**–ü—Ä–∏—á–∏–Ω–∞**: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞ –Ω–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –∏–ª–∏ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ.

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: –µ—Å—Ç—å –ª–∏ –∑–∞–ø–∏—Å—å `üåê –†–µ–∂–∏–º –° –ü–û–ò–°–ö–û–ú`?
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ –ª–æ–≥–∞—Ö –µ—Å—Ç—å `extra_body` —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ–∏—Å–∫–∞
3. –ï—Å–ª–∏ –Ω–µ—Ç ‚Äî –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω—è—è –≤–µ—Ä—Å–∏—è –∫–æ–¥–∞

### –û—à–∏–±–∫–∞: 401 Unauthorized

**–ü—Ä–∏—á–∏–Ω–∞**: –ù–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏–ª–∏ –Ω–µ–≤–µ—Ä–Ω—ã–π API –∫–ª—é—á Perplexity.

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "API –ö–ª—é—á–∏" –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ
2. –î–æ–±–∞–≤—å—Ç–µ –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç–µ –∫–ª—é—á –¥–ª—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ `perplexity`
3. –ò–ª–∏ –∑–∞–¥–∞–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è: `export PPLX_API_KEY=your_key_here`

### –õ–æ–≥–∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç `üìù –ü–æ–∏—Å–∫ –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω`

**–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã**:
1. –ú–æ–¥–µ–ª—å —Ä–µ—à–∏–ª–∞, —á—Ç–æ –≤–µ–±-–ø–æ–∏—Å–∫ –Ω–µ –Ω—É–∂–µ–Ω (—É–º–Ω—ã–π —Ä–µ–∂–∏–º `enable_search_classifier`)
2. –ü–∞—Ä–∞–º–µ—Ç—Ä `disable_search` –ø–µ—Ä–µ–¥–∞–Ω –ø–æ –æ—à–∏–±–∫–µ

**–†–µ—à–µ–Ω–∏–µ**:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≥–∞–ª–∫–∞ "Search" –≤–∫–ª—é—á–µ–Ω–∞
2. –ò–∑–º–µ–Ω–∏—Ç–µ –ø—Ä–æ–º–ø—Ç, —Å–¥–µ–ª–∞–≤ –µ–≥–æ –±–æ–ª–µ–µ —è–≤–Ω—ã–º: "–ù–∞–π–¥–∏ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ..."
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ `extra_body` —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

```bash
tail -100 logs/app.log | grep -A 5 -B 5 "sonar"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∑–∞–ø—Ä–æ—Å–∞ –∫ API

```bash
tail -200 logs/app.log | grep "Request options"
```

–î–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤–∏–¥–Ω–æ: `'extra_body': {'enable_search_classifier': True, ...}`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç API

```bash
tail -200 logs/app.log | grep -E "(search_results|num_search_queries)"
```

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫

- [ ] –°–µ—Ä–≤–µ—Ä –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω —Å –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–µ–π –∫–æ–¥–∞
- [ ] –ú–æ–¥–µ–ª—å `sonar` –∏–ª–∏ `sonar-pro` –≤—ã–±—Ä–∞–Ω–∞
- [ ] –ì–∞–ª–∫–∞ "Search" –≤–∫–ª—é—á–µ–Ω–∞
- [ ] –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å –∑–∞–ø–∏—Å—å `üåê –†–µ–∂–∏–º –° –ü–û–ò–°–ö–û–ú: extra_body = {...}`
- [ ] –í –ª–æ–≥–∞—Ö –µ—Å—Ç—å –∑–∞–ø–∏—Å—å `‚úÖ –ü–æ–∏—Å–∫ –ë–´–õ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω` (–µ—Å–ª–∏ –º–æ–¥–µ–ª—å –≤—ã–ø–æ–ª–Ω–∏–ª–∞ –ø–æ–∏—Å–∫)
- [ ] –í –æ—Ç–≤–µ—Ç–µ –µ—Å—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –∏—Å—Ç–æ—á–Ω–∏–∫–∏
- [ ] –í –Ω–∞–∑–≤–∞–Ω–∏–∏ –º–æ–¥–µ–ª–∏ –µ—Å—Ç—å —Å—É—Ñ—Ñ–∏–∫—Å "+ Search"

## –°–ø—Ä–∞–≤–∫–∞

- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Perplexity**: https://docs.perplexity.ai/api-reference/chat-completions-post
- **–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è**: `docs/PERPLEXITY_SEARCH_FIX.md`
- **–ö–æ–º–º–∏—Ç —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º**: `72038c5`

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏**: 2 –Ω–æ—è–±—Ä—è 2025 –≥.
