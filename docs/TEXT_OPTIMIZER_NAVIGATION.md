# Навигация и редактирование подсветок в оптимизаторе текста

## Обзор изменений (01.11.2025)

Добавлена интерактивная навигация и возможность ручного управления подсветками в интерфейсе оптимизации текста.

## Новые возможности

### 1. Навигация по подсветкам
- **Кнопки "↑ Назад" и "↓ Вперёд"** - перемещение между жёлтыми подсветками
- **Счётчик "N / M"** - показывает текущую позицию и общее количество подсветок
- **Горячие клавиши**:
  - `Shift + ↓` - следующая подсветка
  - `Shift + ↑` - предыдущая подсветка
- **Автопрокрутка** - при навигации текст автоматически прокручивается к выбранной подсветке
- **Визуальная индикация** - текущая подсветка выделяется оранжевой рамкой

### 2. Ручное управление подсветками
- **Клик по жёлтому тексту** - снять подсветку (оставить текст в результате)
- **Клик по обычному тексту** - добавить подсветку (удалить текст из результата)
- **Визуальная обратная связь**:
  - Жёлтый фон = будет удалено
  - Прозрачный фон = останется в тексте
- **Умное применение** - при применении оптимизации учитываются все пользовательские изменения

## Технические детали

### Изменённые файлы
1. `templates/index.html` - добавлены кнопки навигации и счётчик
2. `static/js/text-optimizer.js` - реализована логика навигации и кликов
3. `static/css/styles.css` - добавлены стили для маленьких кнопок

### Структура данных
- `highlightElements` - массив DOM-элементов с подсветками
- `currentHighlightIndex` - индекс текущей активной подсветки
- `userModifiedSpans` - Set с ID изменённых пользователем фрагментов

### Ключевые функции
- `navigateToHighlight(direction)` - навигация вперёд/назад
- `setupClickHandlers()` - установка обработчиков кликов
- `buildOptimizedTextFromDOM()` - сборка финального текста с учётом изменений пользователя
- `updateHighlightCounter()` - обновление счётчика позиций

## Использование

### Базовый сценарий
1. Нажмите "⚡ Оптимизировать текст" в модалке RAG-анализа
2. Просмотрите жёлтые подсветки (удаляемые фрагменты)
3. Используйте кнопки "↑ Назад" / "↓ Вперёд" для навигации
4. Кликните по любой подсветке для её отмены
5. Кликните по обычному тексту для добавления подсветки
6. Нажмите "Оптимизировать" для применения

### Горячие клавиши
- `Shift + ↓` - перейти к следующей подсветке
- `Shift + ↑` - перейти к предыдущей подсветке

## Совместимость
- Работает во всех современных браузерах
- Не требует перезагрузки страницы
- Сохраняет состояние до закрытия модалки
