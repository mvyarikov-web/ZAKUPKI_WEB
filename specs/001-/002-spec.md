# Постановка и спецификация: автоматизация ведения документации приращений разработки и консолидация существующей документации в единый журнал

Дата: 2025-09-30
Статус: Draft
Автор: ИИ-ассистент

## 1) Краткий анализ текущего проекта (контекст)
- Технологии: Python 3.9+, Flask (веб-слой), Jinja2, vanilla JS/HTML/CSS.
- Бизнес-логика: модуль `document_processor` (индексация/поиск по сводному индексу `_search_index.txt`, поддержка ZIP/RAR, OCR best-effort), поиск только по индексу.
- Практики: минимальные изменения, русскоязычная документация/интерфейс, логирование в `logs/app.log` с ротацией, безопасность путей, ограничения загрузок.
- Документация: имеются спецификации/постановки в `specs/` и `docs/` (разрозненно); используются промпты Specify (`.github/prompts/specify.prompt.md`).
- Потребность: единый, линейный журнал приращений (increments) для прозрачной истории проекта и автоматизации документирования изменений.

## 2) Постановка (что и зачем)
Создать единый процесс и формат документирования приращений разработки (increments), который:
- Консолидирует текущую разрозненную документацию в «нулевое» приращение (increment-000).
- В дальнейшем фиксирует каждое изменение в отдельном Markdown-файле стандартизированного формата в папке `increments_doc/`.
- Автоматизирует заполнение разделов «Постановка» и «Спецификация» из Specify; при коммите дополняет дату/время (MSK), hash коммита и краткое описание реализации «простыми словами».
- Гарантирует русскоязычность и единообразие структуры, простоту чтения и проверяемость требований.

Ценности:
- Прозрачная эволюция проекта (след и обоснование изменений).
- Быстрое онбординг/аудит: одно место, один формат.
- Согласованность между спецификацией (что делаем) и реализацией (что сделали).

Критерии успеха (оценка):
- В репозитории присутствует `increments_doc/increment-000.md` с консолидацией текущих постановок/спецификаций/описаний реализации.
- Новое приращение создаётся одной командой/шагом Specify и появляется в `increments_doc/` с корректным именем и автозаполненными разделами.
- После коммита файл автоматически дополнен датой/временем (MSK) и commit hash.
- Документация и интерфейс — на русском, структура идентична для всех increments.

## 3) Спецификация (что именно должно быть реализовано)

### 3.1 Термины
- Increment-файл — Markdown-файл с описанием одного приращения разработки.
- increment-000 — файл-консолидация существующих материалов; начало истории.
- Журнал приращений — директория `increments_doc/` с упорядоченными increment-файлами.

### 3.2 Структура и именование
- Папка: `increments_doc/` (в корне репозитория).
- Формат имени файла: `YYYY-MM-DD_HH-MM_increment-NNN.md`, где:
  - YYYY — год, MM — месяц, DD — день, HH — часы (00–23), MM — минуты (00–59) по MSK;
  - NNN — порядковый номер приращения, фиксированная ширина 3 (001, 002, …), без пропусков.
- Структура содержимого каждого файла (заголовки обязательны, порядок фиксирован):
  1) Дата и время пуша (MSK)
  2) Git commit hash
  3) Постановка (из Specify)
  4) Спецификация (из Specify)
  5) Реализация (простыми словами)
  6) Примечания (опционально)

### 3.3 Создание increment-000 (миграция и консолидация)
- Собрать и включить в `increment-000.md` материалы из существующих папок спецификаций/документации: `specs/`, `docs/` и аналогичных.
- После успешной консолидации и проверки — исходные папки/файлы спецификаций удалить из репозитория, чтобы источником истины стал `increments_doc/`.
- Исключения: файлы `constitution.md`, `.github/copilot-instructions.md` (или `copilot-instructions.md` в проекте), `README.md` — оставить без изменений.

### 3.4 Процесс создания новых приращений (increment ≥ 001)
- Точка входа — постановка через Specify. Текст постановки начинается со слова «Постановка».
- Автоматически создаётся новый файл в `increments_doc/` по шаблону и с корректным именем:
  - Разделы «Постановка» и «Спецификация» заполняются текстами из Specify.
  - Номер `NNN` назначается как (последний + 1), монотонно, без пропусков.
- При выполнении коммита, связанного с данным приращением, в файл автоматически добавляются:
  - «Дата и время пуша (MSK)» — в момент push/commit;
  - «Git commit hash» — SHA текущего коммита;
  - «Реализация (простыми словами)» — краткое описание сути изменений на человеческом языке (может дополняться вручную).

### 3.5 Правила ведения журнала
- Язык: вся документация только на русском.
- Кодировка: UTF‑8, переносы строк Unix (LF).
- Идемпотентность: повторный запуск генерации не должен дублировать increment-файлы; допускается обновление незаполненных разделов.
- Нумерация: строго возрастающая, без пропусков; корректная обработка параллельных веток через явное разрешение конфликтов при merge (человек подтверждает номер).
- Часовой пояс: MSK (Europe/Moscow), фиксируется явно в поле «Дата и время пуша (MSK)».
- Логирование: ключевые события генерации/обновления фиксируются в общем лог-файле проекта.

### 3.6 Нефункциональные требования
- Производительность: операции со строками/файлами — лёгкие; консолидация `increment-000` допускает одноразовую более длительную операцию.
- Надёжность: при ошибках — оставлять частичные артефакты в валидном состоянии или откатывать; не терять исходный контент.
- Безопасность: работать только с файлами внутри репозитория; игнорировать симлинки наружу; не отправлять данные во внешние сети.
- Совместимость: не вмешиваться в логику индексации/поиска и веб-слой; новая функциональность — чисто документационная.

### 3.7 Зависимости и ограничения
- Использовать существующую практику Specify для получения текста «Постановки» и «Спецификации».
- Не добавлять тяжёлые зависимости; операция — файловая, на Markdown.
- Возможные коллизии имен (одновременные инкременты) решаются вручную при merge либо через блокировки на CI в будущем.

### 3.8 Приёмочные сценарии
1) «Нулевое приращение»:
   - Given в репозитории есть `specs/` и/или `docs/` с материалами,
   - When выполняется консолидация,
   - Then создаётся `increments_doc/increment-000.md`, материалы собраны, исходные папки удалены, `constitution.md`, `copilot-instructions.md`, `README.md` сохранены.

2) «Новое приращение»:
   - Given пользователь формирует постановку через Specify,
   - When создаётся новый increment-файл,
   - Then он появляется в `increments_doc/` с корректным именем, заполненными «Постановкой» и «Спецификацией»,
   - And после первого коммита в нём проставляются дата/время (MSK) и commit hash; раздел «Реализация» содержит краткое описание.

3) «Русскоязычность и формат»:
   - Given новые/старые increment-файлы,
   - Then все заголовки разделов и тексты — на русском; структура идентична, кодировка UTF‑8.

### 3.9 Out of Scope (вне рамок этой задачи)
- Генерация подробных релиз-нотов в GitHub Releases.
- Автоматическое редактирование `constitution.md` и `copilot-instructions.md` (требуется отдельная задача после согласования текста).
- Интеграции с внешними таск‑трекерами.

### 3.10 Риски и миграция
- Потеря контента при консолидации: смягчается промежуточной проверкой и резервной веткой/коммитом.
- Конфликты нумерации при параллельной разработке: решаются в код-ревью/merge путем корректировки номера/времени.

## 4) Шаблон increment‑файла (Markdown)
Ниже фиксируется канонический шаблон содержимого:

```
# increment-NNN — Краткое название изменения

Дата и время пуша (MSK): 
Git commit hash: 

## Постановка
(перенос текста постановки из Specify)

## Спецификация
(перенос текста спецификации из Specify)

## Реализация (простыми словами)
(что фактически сделано, зачем, на каком уровне — коротко и понятно)

## Примечания (опционально)
(ограничения, долги, что проверить дополнительно)
```

— Конец спецификации —
