# Постановка

Максимально упрощаем и стабилизируем программу. Выполняем рефакторинг с сокращением функционала:

1) Убрать «светофоры» полностью.
2) Убрать обратный поиск («не содержит») вместе с кнопкой.
3) Убрать визуализацию прогресса индексации с плашками (быстрые/средние/медленные) — оставить простую полоску прогресса.
4) Убрать поддержку архивов. Неподдерживаемые файлы после индексации должны отображаться в интерфейсе и помечаться красным с текстом «0, не поддерживается».
5) Переименовать проект из «Анализ документов закупки» в «Пакетный анализ документов».
6) Скорректировать список поддерживаемых форматов (исключить архивы).
7) Полностью убрать ветку «анализ документов» (UI и соответствующий код/роуты).
8) Очистить код: удалить артефакты старого функционала.
9) Добавить возможность выбирать не только папку, но и конкретный файл для индексации.
10) Убрать удаление конкретных файлов/папок — оставить только «Удалить все».
11) Не поддерживать вложенные папки. Работать только с файлами непосредственно внутри выбранной папки. Если выбрана одна папка и она не удалена — кнопка «Выбрать папку» неактивна. Становится активной после удаления папки кнопкой «Удалить файлы».

# Спецификация

## Область изменений
- UI: `templates/*`, `static/js/*`, тексты (переименование, удаление элементов).
- Бэкенд: Flask-роуты (`app.py`, `webapp/*`), состояние/валидация, интеграция с индексатором.
- Индексация/поиск: `document_processor/*` — убрать архивы и групповые индикаторы прогресса.

## Функциональные требования

### 1) Светофоры
- Удалить все цветовые статусы (светофоры) и связанные элементы UI.
- Удалены функции: `getTrafficLightColor`, `calculateFolderStatus`, `calculateArchiveStatus`, `updateTrafficLightsAfterSearch`
- Удалён модуль `static/js/traffic-lights.js` из HTML

### 2) Обратный поиск
- Удалить режим «не содержит» и элементы управления (toggle switch).
- Поиск — только по положительным терминам.
- Удалён `excludeModeToggle` из JS и HTML

### 3) Прогресс индексации
- Убрать групповые плашки (fast/medium/slow).
- Оставить одну полоску прогресса, процент и время формирования.
- Удалён блок `groupsIndicator` из HTML

### 4) Архивы (ZIP/RAR)
- Полностью исключить из индексации и поддержки.
- В UI показывать как «0, не поддерживается» (красным), но в списке файлов оставлять.
- Удалены из `ALLOWED_EXTENSIONS` в конфигурации
- Упрощён `files_json()` — без обработки архивов
- Удалена функция `download_from_archive()`

### 5) Переименование продукта
- Везде заменить «Анализ документов закупки» на «Пакетный анализ документов» (UI, заголовки, README).
- Обновлён `<title>` и `<h1>` в `index.html`
- Обновлён README.md

### 6) Поддерживаемые форматы
- Разрешить: TXT, PDF, DOCX, DOC, XLSX, XLS, CSV, TSV, HTML/HTM, XML, JSON.
- Запретить: ZIP, RAR и прочие архивы.

### 7) Удаление ветки «анализ документов»
- Удалить страницы/роуты/кнопки, относящиеся к этому разделу.
- Удалён `analysis_bp` из `webapp/__init__.py`
- Удалена кнопка «Анализ документов» из HTML
- Удален модуль анализа из `static/js/script.js` (~167 строк)

### 8) Очистка кода
- Удалить/деактивировать логику и артефакты светофоров, архивов, обратного поиска и ветки анализа.
- Упрощены функции `updateFilesList()` и `renderFileItem()` в JS

### 9) Выбор источника
- Поддержать выбор либо одной папки, либо одного или нескольких файлов.
- Добавлена кнопка «Выбрать файлы» в интерфейс
- Реализована функция для выбора файлов через `<input type="file" multiple>`

### 10) Удаление
- Оставить только «Удалить все»: очищает `uploads/` и индекс/состояние в `index/`.
- Удалены кнопки удаления отдельных файлов и папок из HTML
- Кнопка переименована на «Удалить все»

### 11) Вложенные папки
- Индексировать только файлы верхнего уровня выбранной папки.
- Подпапки не разворачивать, помечать как неподдерживаемые.
- Упрощён `files_json()` — использует `os.listdir()` вместо `os.walk()`

## Нефункциональные требования
- Локализация: русский язык; JSON UTF-8 (`JSON_AS_ASCII=False`).
- Надёжность: ошибки чтения/кодировок не валят процесс; логировать и продолжать.
- Безопасность: проверки безопасного пути при скачивании/удалении; защита от traversal.
- Производительность: поиск только по индексу `_search_index.txt`.

# Реализация (простыми словами)

Выполнен масштабный рефакторинг для упрощения и стабилизации приложения:

## Удалено:
- **Светофоры**: все визуальные индикаторы статусов файлов и связанные функции (~200 строк кода)
- **Обратный поиск**: режим "не содержит" с toggle switch
- **Групповые индикаторы**: плашки fast/medium/slow для прогресса индексации
- **Архивы**: полностью убрана поддержка ZIP/RAR (~150 строк кода)
- **Анализ документов**: весь модуль с UI, роутами и JS логикой (~167 строк)
- **Индивидуальное удаление**: кнопки удаления отдельных файлов/папок

## Добавлено:
- Кнопка «Выбрать файлы» для загрузки отдельных файлов
- Простая работа только с файлами верхнего уровня

## Изменено:
- Название: «Пакетный анализ документов»
- Список форматов без архивов
- Кнопка «Удалить все» вместо множественных кнопок удаления
- Упрощённая структура `files_json` без вложенных папок

## Файлы изменены:
- `webapp/config.py` — убраны архивы из ALLOWED_EXTENSIONS
- `webapp/__init__.py` — удалён analysis_bp
- `webapp/routes/files.py` — упрощены files_json, download_file
- `document_processor/search/indexer.py` — убраны архивы из SUPPORTED_EXT
- `templates/index.html` — новый заголовок, удалены элементы UI
- `static/js/script.js` — удалены светофоры, архивы, анализ (~400 строк)
- `README.md` — обновлена документация

## Результат:
- Уменьшен размер кода на ~900 строк
- Упрощён интерфейс: 4 кнопки вместо 5+ элементов управления
- Убраны сложные функции обработки архивов и светофоров
- Более стабильная и понятная система

# Дата и время пуша (MSK)
2025-10-19 20:47:03 MSK

# Git commit hash
54bb9839bbda365657fed512fe339595518c4e98

# Примечания
- CSS стили для светофоров остались в файле, но не используются (можно почистить в будущем)
- Тестирование с реальными файлами рекомендуется выполнить вручную
- Все функции модуля document_processor для обработки архивов остались, но не вызываются из веб-интерфейса
