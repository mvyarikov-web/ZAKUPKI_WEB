# Постановка

Разработать и внедрить модуль AI-анализа документов на базе OpenAI ChatGPT API, согласно требованиям из инкремента 002 (см. предыдущий файл). Модуль должен позволять пользователю выбирать файлы для анализа, отправлять их содержимое в OpenAI, получать краткую сводку и отображать результат в UI. Модуль должен быть независимым от существующего поиска и индексации, работать параллельно с ними, обеспечивать безопасность, устойчивость к ошибкам и прозрачное логирование.

# Спецификация

**1. Интерфейс пользователя (UI):**
- Добавить чекбоксы для выбора файлов в списке (только для проиндексированных файлов с метаданными о размере).
- Кнопка "AI-анализ" активна только при выборе хотя бы одного файла.
- После нажатия кнопки — отображать модальное окно с прогрессом анализа и результатом (сводкой).
- В случае ошибки — показывать понятное сообщение.

**2. Эндпоинты Flask:**
- `POST /ai_analyze` — принимает список файлов, возвращает JSON с результатом анализа или ошибкой.
- `GET /ai_status/<task_id>` — статус и результат асинхронной задачи анализа.

```markdown
# Постановка

Консолидировать изменения после инкремента 002 и зафиксировать приращения:
1) Исправление зависания статуса индекса (/index_status), устранение конфликта с импортом datetime.
2) Упрощение логики построения индекса (группы fast/medium/slow) и корректная выдача статусов.
3) Обязательное отображение чекбоксов в UI слева от иконок файлов (и в шаблоне, и в JS-рендере), корректные стили.
4) Улучшение извлечения текста из .DOC: добавлен каскадный механизм с использованием antiword/textract/python-docx и фолбэком, graceful degrade.
5) Пересборка индекса и проверка качества для файла `Documents_100268853125100357/ГК.DOC` (рост качества ~23% → ~79%).

# Спецификация

**Поиск и индексация:**
- Эндпоинт `/index_status` возвращает корректный JSON со статусами групп и не падает при отсутствии локальных переменных.
- Групповая индексация (fast/medium/slow); статусные файлы в `index/status.json`.

**Извлечение .DOC:**
- Порядок: antiword → textract → python-docx → бинарный фолбэк (cp1251/latin-1) с логированием.
- OCR и RAR остаются опциональными; пропуски — без падения сервера.

**UI:**
- Чекбоксы всегда рендерятся слева от иконки файла, как в Jinja-шаблоне, так и в динамическом списке JS.
- Добавлены стили для видимости и выравнивания.

**Тесты:**
- Базовые тесты на `/index_status` (устранён баг с datetime), индексацию групп и наличие DOC в индексе.

# Реализация (простыми словами)

- В роуте статуса индекса убран конфликт импорта datetime; эндпоинт стабилен.
- Индексация пересобрана на группы, статусы корректно обновляются.
- Чекбоксы принудительно показываются; правки в `templates/index.html`, `static/js/script.js`, `static/css/styles.css`.
- В `document_processor/search/indexer.py` добавлены вызовы antiword/textract и улучшен фолбэк; качество .DOC заметно выросло.
- Пересобран индекс; проверен фрагмент для `ГК.DOC`.

# Примечания

- Все сообщения и интерфейс — на русском языке.
- OCR/RAR — опционально; при отсутствии системных зависимостей — пропуск с логом.
- Поиск выполняется только по индексу `_search_index.txt`.

## Дата и время пуша (MSK)
- будет проставлено после коммита

## Git commit hash
- будет проставлен после коммита

```
