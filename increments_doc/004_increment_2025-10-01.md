# Инкремент-004: История загрузок, метаданные, отображение и API

Дата и время пуша (МСК): 2025-10-01 15:00
Хэш коммита Git: 6592b35af254952ee2fc2befaa2cb8d58a0ce9cd

## Постановка

**Цель**: реализовать историю загрузок с отображением даты, времени, полного пути и имени папки, а также обеспечить API и UI для получения и отображения этих данных.

### 1) История загрузок
- При каждой загрузке папки сохранять метаданные: дата/время (МСК), полный путь, имя папки, порядковый номер загрузки.
- История хранится в отдельном JSON-файле (`index/upload_history.json`).
- При удалении папки соответствующая запись удаляется из истории.
- Формат записи: «Дата Время загрузки — Полный путь — Имя папки (загрузка N)».

### 2) API и UI
- Новый эндпоинт `/upload_history` возвращает историю загрузок в JSON.
- В блоке "Загрузка папки" отображается актуальный список всех загруженных папок с полной информацией.
- При добавлении новых папок — новые записи добавляются ниже существующих.
- При удалении — записи удаляются.
- Для архивов отображать виртуальный путь с пометкой "Архив".
- Формат даты/времени: `YYYY-MM-DD HH:MM` (МСК).

## Спецификация

### Функциональные требования
- **FR-015**: Сохранять историю загрузок с метаданными (дата/время, путь, имя, номер).
- **FR-016**: Хранить историю в `index/upload_history.json`.
- **FR-017**: Удалять запись из истории при удалении папки.
- **FR-018**: Новый эндпоинт `/upload_history` для получения истории.
- **FR-019**: В UI отображать список загруженных папок с полной информацией.
- **FR-020**: Для архивов отображать виртуальный путь с пометкой "Архив".
- **FR-021**: Формат даты/времени — `YYYY-MM-DD HH:MM` (МСК).

### Критерии приёмки
- **CR-008**: После загрузки папки запись появляется в истории и отображается в UI.
- **CR-009**: После удаления папки запись исчезает из истории и UI.
- **CR-010**: Эндпоинт `/upload_history` возвращает актуальный JSON.
- **CR-011**: Формат даты/времени соответствует требованиям.
- **CR-012**: Для архивов отображается виртуальный путь с пометкой "Архив".

## Реализация (простыми словами)

- В обработчике загрузки (`/upload`) добавлен код для записи метаданных в `index/upload_history.json`.
- При удалении папки (`/delete_folder`) запись удаляется из истории.
- Новый эндпоинт `/upload_history` возвращает содержимое истории.
- В UI (блок "Загрузка папки") реализован вывод истории загрузок, формат: «Дата Время загрузки — Полный путь — Имя папки (загрузка N)».
- Для архивов путь отображается с пометкой "Архив".
- Формат даты/времени — `YYYY-MM-DD HH:MM` (МСК).

## Примечания

- История хранится только для поддерживаемых загруженных папок.
- Для корректной работы требуется синхронизация между удалением файлов и историей.
- В случае ошибок записи/чтения истории — логировать, но не прерывать основной процесс загрузки/удаления.
