# increment-013 ‚Äî –°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è OCR

–î–∞—Ç–∞ –∏ –≤—Ä–µ–º—è –ø—É—à–∞ (MSK): –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç–∞–≤–ª–µ–Ω–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∫–æ–º–º–∏—Ç–µ
Git commit hash: –±—É–¥–µ—Ç –ø—Ä–æ—Å—Ç–∞–≤–ª–µ----------------------------------
üîó –≠—Ç–∞–ø 5 ‚Äî –£–ª—É—á—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ OCR (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è)

–¶–µ–ª—å: –ø–æ–≤—ã—Å–∏—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ ¬´–ø–ª–æ—Ö–∏—Ö¬ª —Å–∫–∞–Ω–æ–≤ (–ø–µ—Ä–µ–∫–æ—Å, —à—É–º, –Ω–∏–∑–∫–∏–π –∫–æ–Ω—Ç—Ä–∞—Å—Ç).

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- **–ü—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
  - –û—Ç–¥–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è `_preprocess_image(img: Image) ‚Üí Image` –≤ `PdfReader`
  - –û–ø–µ—Ä–∞—Ü–∏–∏: —Å–µ—Ä–∞—è —à–∫–∞–ª–∞, –±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è –ø–æ –ø–æ—Ä–æ–≥—É, —É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Ä–µ–∑–∫–æ—Å—Ç–∏ (PIL)
  - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–æ –≤—ã–∑–æ–≤–∞ `pytesseract.image_to_string()`
  
- **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:**
  - `OCR_PREPROCESS_ENABLED=False` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–∫–ª—é—á–µ–Ω–æ)
  - –ü—Ä–∏ –≤–∫–ª—é—á–µ–Ω–∏–∏ ‚Äî –ø—Ä–∏–º–µ–Ω—è—Ç—å –∫ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –ø–µ—Ä–µ–¥ OCR
  - –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è PIL ‚Äî —É–∂–µ –µ—Å—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö
  
- **Graceful degradation:**
  - –ï—Å–ª–∏ –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ –ø–∞–¥–∞–µ—Ç ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å, –ø—Ä–æ–±–æ–≤–∞—Ç—å OCR –±–µ–∑ –Ω–µ–≥–æ
  - –ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
  
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –Ω–∏–∑–∫–∏–π (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è), —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –ø–æ—Å–ª–µ —ç—Ç–∞–ø–æ–≤ 1-4

–¢–µ—Å—Ç—ã:
- –°–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–π PDF —Å –Ω–∏–∑–∫–∏–º –∫–æ–Ω—Ç—Ä–∞—Å—Ç–æ–º: –¥–ª–∏–Ω–∞ —Ç–µ–∫—Å—Ç–∞ —Å –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–æ–º > –±–µ–∑ –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–∞.
- –û—à–∏–±–∫–∞ –≤ –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥–µ ‚Üí OCR –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å (fallback –Ω–∞ –∏—Å—Ö–æ–¥–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ).
- `OCR_PREPROCESS_ENABLED=False` ‚Üí –ø—Ä–µ–ø—Ä–æ—Ü–µ—Å—Å–∏–Ω–≥ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è (–ø—Ä–æ–≤–µ—Ä–∫–∞ —á–µ—Ä–µ–∑ –º–æ–∫).–∫–æ–º–º–∏—Ç–µ

## –ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞

–ü–æ–≤—ã—Å–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, —Å–∫–æ—Ä–æ—Å—Ç—å –∏ –∫–∞—á–µ—Å—Ç–≤–æ OCR-–æ–±—Ä–∞–±–æ—Ç–∫–∏ PDF-–¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º –º–æ–¥—É–ª–µ `PdfReader`, —Å–æ—Ö—Ä–∞–Ω—è—è –ø–æ–ª–Ω—É—é –æ–±—Ä–∞—Ç–Ω—É—é —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –ø—Ä–æ–µ–∫—Ç–∞.

## –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞ (–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω–æ)

**–¢–µ–∫—É—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (–ù–ï –ú–ï–ù–Ø–¢–¨):**
- –ò–Ω–¥–µ–∫—Å —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤ `uploads/_search_index.txt` (–æ–¥–∏–Ω —Ñ–∞–π–ª-–∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –ø–æ–∏—Å–∫–∞)
- –ü–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `Searcher.search(index_path, keywords)` –ø–æ –≥–æ—Ç–æ–≤–æ–º—É –∏–Ω–¥–µ–∫—Å—É
- `DocumentProcessor.create_search_index('uploads')` ‚Äî –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
- HTTP-—Ä—É—á–∫–∏: `/upload` ‚Üí `/build_index` ‚Üí `/search` (OCR —Ç–æ–ª—å–∫–æ –≤ `/build_index`)
- –í—Å–µ —Ç—è–∂—ë–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (OCR, RAR) ‚Äî **—Ç–æ–ª—å–∫–æ** –Ω–∞ —ç—Ç–∞–ø–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏, **–Ω–µ** –≤ HTTP-–ø–æ–∏—Å–∫–µ

**–ü—Ä–∏–Ω—Ü–∏–ø—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Ç–æ–ª—å–∫–æ –≤–Ω—É—Ç—Ä–∏ `PdfReader._extract_text_ocr`)
- ‚úÖ –ü—É–±–ª–∏—á–Ω—ã–π API `read_pdf()` –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- ‚úÖ Indexer –≤—ã–∑—ã–≤–∞–µ—Ç `PdfReader` –∫–∞–∫ –∏ —Å–µ–π—á–∞—Å (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤)
- ‚úÖ –í—Å–µ –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã, –≤—ã–∫–ª—é—á–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥-—Ñ–ª–∞–≥–∏)
- ‚úÖ Graceful degradation (–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ tesseract/OpenCV –Ω–µ —Ä–æ–Ω—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å)

----------------------------------
## –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è

### üéØ –û–±—â–∞—è —Ü–µ–ª—å
- –†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ä—É—Å—Å–∫–∏—Ö –∏ –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö PDF (–≤–µ–∫—Ç–æ—Ä –∏ —Å–∫–∞–Ω—ã) ‚Äî –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: —Ç–∞–π–º-–∞—É—Ç—ã, –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Å—Ç—Ä–∞–Ω–∏—Ü
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: –Ω–µ –ª–æ–º–∞–µ—Ç —Ç–µ–∫—É—â—É—é –ª–æ–≥–∏–∫—É –∏ —Ç–µ—Å—Ç—ã

----------------------------------
ü™ú –≠—Ç–∞–ø 1 ‚Äî OCR —è–¥—Ä–æ (—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è)

–¶–µ–ª—å: —Å–¥–µ–ª–∞—Ç—å —Ç–µ–∫—É—â–∏–π PdfReader —É—Å—Ç–æ–π—á–∏–≤—ã–º –∏ –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –µ–≥–æ –ø—É–±–ª–∏—á–Ω–æ–≥–æ API –∏ –≤—ã–∑–æ–≤–æ–≤ –∏–∑ Indexer.

–ß—Ç–æ –º–µ–Ω—è–µ–º (–º–∏–Ω–∏–º–∞–ª—å–Ω–æ):
- –í `document_processor/pdf_reader/reader.py` –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å `_extract_text_ocr()`:
	- –¥–æ–±–∞–≤–∏—Ç—å —Ç–∞–π–º-–∞—É—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É: `pytesseract.image_to_string(..., timeout=30)`;
	- –æ–±–æ—Ä–∞—á–∏–≤–∞—Ç—å —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ try/except (–æ—à–∏–±–∫–∞ ‚Üí –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å);
	- –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º: –Ω–æ–º–µ—Ä, –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –æ—à–∏–±–∫–∏.
- –î–æ–±–∞–≤–∏—Ç—å `document_processor/pdf_reader/image_utils.py` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞):
	- —Ñ—É–Ω–∫—Ü–∏–∏: `preprocess_image_for_ocr(img)` —Å PIL (+ OpenCV –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏): grayscale ‚Üí (adaptive) binarize ‚Üí dpi=300;
	- –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –≤ try/except, –ø—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî –≤–æ–∑–≤—Ä–∞—Ç –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è.
- –ö–æ–Ω—Ñ–∏–≥ `webapp/config.py` (–±–µ–∑ –ª–æ–º–∫–∏ —Å—Ç–∞—Ä—ã—Ö –∫–ª—é—á–µ–π):
	- `OCR_TIMEOUT_PER_PAGE = 30` (–Ω–æ–≤—ã–π, –¥–µ—Ñ–æ–ª—Ç);
	- `OCR_PREPROCESS_ENABLED = False` (–Ω–æ–≤—ã–π, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –≤–∫–ª—é—á–∞–µ—Ç—Å—è);
	- —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ `PDF_OCR_*` –æ—Å—Ç–∞—é—Ç—Å—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –ø—Ä–∞–≤–¥—ã (–º–∞–ø–ø–∏–Ω–≥ –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ).
- Indexer –æ—Å—Ç–∞—ë—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ API: –≤—ã–∑—ã–≤–∞–µ—Ç `PdfReader().read_pdf(...)` –∫–∞–∫ –∏ —Å–µ–π—á–∞—Å.

–ö–æ–Ω—Ç—Ä–∞–∫—Ç –∏ –æ—à–∏–±–∫–∏:
- –ü—É–±–ª–∏—á–Ω—ã–π –º–µ—Ç–æ–¥ `read_pdf()` –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è (–≤–∫–ª—é—á–∞—è —Ñ–æ—Ä–º–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞).
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ tesseract/pdf2image/Pillow ‚Äî WARNING –∏ –ø—É—Å—Ç–æ–π OCR-—Ç–µ–∫—Å—Ç (graceful degrade).
- –¢–∞–π–º-–∞—É—Ç—ã –∏ –æ—à–∏–±–∫–∏ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –Ω–µ —Ä–æ–Ω—è—é—Ç –ø—Ä–æ—Ü–µ—Å—Å, —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è.

–¢–µ—Å—Ç—ã (–º–∏–Ω–∏–º—É–º):
- happy-path: OCR –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã (—Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ) ‚Üí –Ω–µ–ø—É—Å—Ç–æ–π —Ç–µ–∫—Å—Ç;
- timeout: –º–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–µ–≤—ã—à–∞–µ—Ç 30 —Å–µ–∫ ‚Üí —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è, –ø—Ä–æ—Ü–µ—Å—Å –∂–∏–≤;
- –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π: –ø—Ä–æ–ø—É—Å–∫ OCR –±–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏–π;
- –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–∞: –≤–∫–ª—é—á—ë–Ω/–≤—ã–∫–ª—é—á–µ–Ω —Ñ–ª–∞–≥, –æ—à–∏–±–∫–∏ –Ω–µ —Ä–æ–Ω—è—é—Ç –ø—Ä–æ—Ü–µ—Å—Å.

–ö—Ä–∏—Ç–µ—Ä–∏–π –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏:
- –í—Å–µ –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç; Indexer –∏ Searcher –Ω–µ –ø–æ–º–µ–Ω—è–ª–∏ –ø–æ–≤–µ–¥–µ–Ω–∏–µ.

----------------------------------
‚ö° –≠—Ç–∞–ø 2 ‚Äî –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏

–¶–µ–ª—å: —É—Å–∫–æ—Ä–∏—Ç—å OCR –±–µ–∑ –ª–æ–º–∫–∏ –ª–æ–≥–∏–∫–∏ –∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤.

–ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –∑–∞ —Ñ–ª–∞–≥–∞–º–∏):
- –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ (OSD) –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç:
	- –ø–æ–ø—ã—Ç–∫–∞ `pytesseract.image_to_osd(first_page)`; –ø—Ä–∏ –æ—à–∏–±–∫–µ ‚Äî fallback 0¬∞;
	- –∫—ç—à –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π; –ø—Ä–∏–º–µ–Ω—è—Ç—å –ø–æ–≤–æ—Ä–æ—Ç –∫–æ –≤—Å–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º.
- –ü–∞—Ä–∞–ª–ª–µ–ª–∏–∑–∞—Ü–∏—è OCR —Å—Ç—Ä–∞–Ω–∏—Ü —á–µ—Ä–µ–∑ `ThreadPoolExecutor(max_workers=min(4, os.cpu_count()))`:
	- –±–µ–∑–æ–ø–∞—Å–Ω–æ, —Ç.–∫. tesseract ‚Äî –≤–Ω–µ—à–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã; –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –ø—É–ª, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —Å–∏—Å—Ç–µ–º—É;
	- —Ç–∞–π–º-–∞—É—Ç –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–¥–∞—á–µ –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã.
- –ü—Ä–æ–ø—É—Å–∫ –ø—É—Å—Ç—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü: –µ—Å–ª–∏ –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ length < N (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5) ‚Äî –Ω–µ —É—á–∏—Ç—ã–≤–∞—Ç—å.

–ö–æ–Ω—Ñ–∏–≥ (–Ω–æ–≤—ã–µ —Ñ–ª–∞–≥–∏, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é OFF):
- `OCR_USE_OSD = False`, `OCR_PARALLEL_PAGES = False`, `OCR_MAX_WORKERS = 4`.

–¢–µ—Å—Ç—ã:
- –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ 3‚Äì4 —Å—Ç—Ä–∞–Ω–∏—Ü (–º–æ–∫–∏ tesseract) ‚Üí —Å—É–º–º–∞—Ä–Ω–æ–µ –≤—Ä–µ–º—è –º–µ–Ω—å—à–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ–≥–æ;
- OSD –Ω–µ —Ä–æ–Ω—è–µ—Ç –ø–æ—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–µ; –ø—Ä–∏ —É—Å–ø–µ—Ö–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –Ω–µ–ø—É—Å—Ç–æ–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç.

–†–∏—Å–∫–∏ –∏ –º–µ—Ä—ã:
- –ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ CPU ‚Üí –ª–∏–º–∏—Ç –ø—É–ª–∞;
- –ù–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å OSD ‚Üí try/except + fallback 0¬∞.

----------------------------------
üß≠ –≠—Ç–∞–ø 3 ‚Äî –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ä—è–¥–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–æ–≤

–¶–µ–ª—å: —É—Å–∫–æ—Ä–∏—Ç—å –ø–æ–ª—É—á–µ–Ω–∏–µ –ø–µ—Ä–≤—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –∏–Ω–¥–µ–∫—Å–∞.

–ü–æ–¥—Ö–æ–¥ (—Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å —Ç–µ–∫—É—â–µ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π):
- Indexer –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å **–æ–¥–∏–Ω** `uploads/_search_index.txt` –∑–∞ –æ–¥–∏–Ω –ø—Ä–æ—Ö–æ–¥ (–∫–∞–∫ —Å–µ–π—á–∞—Å).
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è: –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Ñ–∞–π–ª—ã –≤ –ø–æ—Ä—è–¥–∫–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:
  1. –°–Ω–∞—á–∞–ª–∞: TXT, CSV, HTML (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ)
  2. –ó–∞—Ç–µ–º: DOCX, XLSX, –≤–µ–∫—Ç–æ—Ä–Ω—ã–µ PDF (–±—ã—Å—Ç—Ä–æ)
  3. –í –∫–æ–Ω—Ü–µ: PDF-—Å–∫–∞–Ω—ã —Å OCR (–º–µ–¥–ª–µ–Ω–Ω–æ)
- –ò–Ω–¥–µ–∫—Å –¥–æ–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ, –Ω–æ –æ—Å—Ç–∞—ë—Ç—Å—è **–µ–¥–∏–Ω—ã–º** —Ñ–∞–π–ª–æ–º.

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–º–∏–Ω–∏–º—É–º):
- –í `Indexer._iter_sources()` —Å–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –ø–æ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—é (–ª—ë–≥–∫–∏–µ ‚Üí —Ç—è–∂—ë–ª—ã–µ).
- –ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å: –ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª `uploads/._search_index.tmp`, –∑–∞–º–µ–Ω—è—Ç—å —á–µ—Ä–µ–∑ `os.replace()`.
- **–ù–ï** —Å–æ–∑–¥–∞–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ `index_text.txt` / `index_ocr.txt` (–∏–∑–±—ã—Ç–æ—á–Ω–æ, –ª–æ–º–∞–µ—Ç –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É).

–¢–µ—Å—Ç—ã:
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ—Ä—è–¥–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏: TXT-—Ñ–∞–π–ª—ã –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ä–∞–Ω—å—à–µ PDF —Å OCR.
- –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å: –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ Searcher –≤–∏–¥–∏—Ç –ª–∏–±–æ —Å—Ç–∞—Ä—É—é, –ª–∏–±–æ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –∏–Ω–¥–µ–∫—Å–∞ (–Ω–∏–∫–æ–≥–¥–∞ –ø–æ–ª—É–±–∏—Ç—É—é).

----------------------------------
üìü –≠—Ç–∞–ø 4 ‚Äî –ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏

–¶–µ–ª—å: –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å —Ö–æ–¥ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –≤ UI –±–µ–∑ –ë–î –∏ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫.

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è (–º–∏–Ω–∏–º—É–º):
- Indexer –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –æ–±–Ω–æ–≤–ª—è–µ—Ç `index/status.json`:
  ```json
  {
    "total": 100,
    "processed": 45,
    "current_file": "–¥–æ–∫—É–º–µ–Ω—Ç.pdf",
    "current_format": "PDF",
    "ocr_active": true,
    "started_at": "2025-10-19T15:30:00",
    "updated_at": "2025-10-19T15:35:22"
  }
  ```
- –ó–∞–ø–∏—Å—å –∫–∞–∂–¥—ã–µ N —Ñ–∞–π–ª–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5) –∏–ª–∏ –ø—Ä–∏ –∫–∞–∂–¥–æ–º PDF —Å OCR.
- –ù–æ–≤—ã–π GET `/index_status` (Flask): –æ—Ç–¥–∞—ë—Ç —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ `index/status.json` –∏–ª–∏ `{"status": "idle"}`.
- UI: –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏–π –æ–ø—Ä–æ—Å `/index_status` –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–∞.

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:
- –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ `index/status.json`, –Ω–∏–∫–∞–∫–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤.
- –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ñ–∞–π–ª–∞ ‚Äî –≤–æ–∑–≤—Ä–∞—Ç `{"status": "idle"}`.

–¢–µ—Å—Ç—ã:
- –ü—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Ñ–∞–π–ª –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è; —Ä—É—á–∫–∞ `/index_status` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π JSON.
- UI (—Ä—É—á–Ω–æ–π —Ç–µ—Å—Ç): –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.

----------------------------------
üéØ –≠—Ç–∞–ø 5 ‚Äî –ü–æ–≤—ã—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ OCR

–¶–µ–ª—å: –ø–æ–≤—ã—Å–∏—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ –±–µ–∑ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —É–¥–æ—Ä–æ–∂–∞–Ω–∏—è.

–ß—Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º (–≤ `image_utils.py`, –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
- –§–∏–ª—å—Ç—Ä—ã: –±–∏–Ω–∞—Ä–∏–∑–∞—Ü–∏—è (adaptive), —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ (median/gaussian –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ OpenCV), –ø–æ–≤—ã—à–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ (PIL ImageEnhance).
- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–∏ —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥: `OCR_PREPROCESS_ENABLED=True` –≤–∫–ª—é—á–∞–µ—Ç pipeline —Ü–µ–ª–∏–∫–æ–º.

–¢–µ—Å—Ç—ã:
- synthetic: –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–∑–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ ‚Üí —Ç–µ–∫—Å—Ç —Ä–∞—Å–ø–æ–∑–Ω–∞—ë—Ç—Å—è –ª—É—á—à–µ –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–π –ø—Ä–µ–¥–æ–±—Ä–∞–±–æ—Ç–∫–µ;
- –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ OpenCV –Ω–µ –ª–æ–º–∞–µ—Ç —Ç–µ—Å—Ç—ã (graceful degrade).

----------------------------------
üîó –≠—Ç–∞–ø 6 ‚Äî –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ (–∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –∏ —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—à–∏–±–∫–∞–º)

–¶–µ–ª—å: –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å, —á—Ç–æ Searcher –≤—Å–µ–≥–¥–∞ —á–∏—Ç–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π –∏–Ω–¥–µ–∫—Å, –¥–∞–∂–µ –≤–æ –≤—Ä–µ–º—è –µ–≥–æ –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏.

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:
- **–ê—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å –∏–Ω–¥–µ–∫—Å–∞** (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):
  - –ü—Ä–∏ —Å–±–æ—Ä–∫–µ –∏–Ω–¥–µ–∫—Å–∞ –ø–∏—Å–∞—Ç—å –≤–æ –≤—Ä–µ–º–µ–Ω–Ω—ã–π `uploads/._search_index.tmp`
  - –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–º–µ–Ω–∏—Ç—å —á–µ—Ä–µ–∑ `os.replace('._search_index.tmp', '_search_index.txt')`
  - Searcher –≤—Å–µ–≥–¥–∞ —á–∏—Ç–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ñ–∞–π–ª (–Ω–∏–∫–æ–≥–¥–∞ –ø–æ–ª—É–±–∏—Ç—ã–π)
  
- **–ß–∞—Å—Ç–∏—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ** (—ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ, –æ—Ç–ª–æ–∂–∏—Ç—å):
  - –¢—Ä–µ–±—É–µ—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (mtime –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞)
  - –†–∏—Å–∫: —É–¥–∞–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –æ—Å—Ç–∞–Ω—É—Ç—Å—è –≤ –∏–Ω–¥–µ–∫—Å–µ
  - **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –≤ —ç—Ç–æ–º –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–µ, –æ—Å—Ç–∞–≤–∏—Ç—å –¥–ª—è –±—É–¥—É—â–∏—Ö –≤–µ—Ä—Å–∏–π

- **–£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—à–∏–±–∫–∞–º:**
  - –ü—Ä–∏ –æ—à–∏–±–∫–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Ñ–∞–π–ª–∞ ‚Äî –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å, –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—é
  - –í—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª `.tmp` —É–¥–∞–ª—è—Ç—å –ø—Ä–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏—è—Ö
  - –ù–µ –æ—Å—Ç–∞–≤–ª—è—Ç—å —á–∞—Å—Ç–∏—á–Ω–æ –∑–∞–ø–∏—Å–∞–Ω–Ω—ã–π –∏–Ω–¥–µ–∫—Å

–¢–µ—Å—Ç—ã:
- –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å: –∏–º–∏—Ç–∞—Ü–∏—è –ø—Ä–µ—Ä—ã–≤–∞–Ω–∏—è –≤–æ –≤—Ä–µ–º—è –∑–∞–ø–∏—Å–∏ ‚Üí —Å—Ç–∞—Ä—ã–π –∏–Ω–¥–µ–∫—Å –æ—Å—Ç–∞—ë—Ç—Å—è –≤–∞–ª–∏–¥–Ω—ã–º.
- –£—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å: —Ñ–∞–π–ª —Å –æ—à–∏–±–∫–æ–π ‚Üí –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ñ–∞–π–ª—ã –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è, –∏—Ç–æ–≥–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω.
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ: Searcher —á–∏—Ç–∞–µ—Ç –≤–æ –≤—Ä–µ–º—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∏ ‚Üí –Ω–µ –ø–∞–¥–∞–µ—Ç, —á–∏—Ç–∞–µ—Ç —Å—Ç–∞—Ä—É—é –∏–ª–∏ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é.

----------------------------------

---

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–∏–Ω—Ü–∏–ø—ã
- –û—Å–Ω–æ–≤–Ω—ã–µ —Ç–µ—Å—Ç—ã ‚Äî –ª—ë–≥–∫–∏–µ, —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏–µ PDF —Å –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–º —Å–æ–¥–µ—Ä–∂–∏–º—ã–º
- –¢–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º OCR ‚Äî –ø–æ–º–µ—Ç–∫–∞ `@pytest.mark.ocr` –∏ `skip` –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Ç—Ä–µ–±—É—é—Ç tesseract)
- –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã ‚Äî —á–µ—Ä–µ–∑ —Ñ–∏–∫—Å—Ç—É—Ä—É `tmp_path`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤ —á–µ—Ä–µ–∑ `caplog` (—Ç–∞–π–º–∞—É—Ç—ã, –æ—à–∏–±–∫–∏, –ø—Ä–æ–ø—É—Å–∫–∏)

### –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏
1. **–°—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è (–≠—Ç–∞–ø 1):**
   - –§–∞–π–ª: `tests/test_ocr_timeouts.py`
   - `test_ocr_timeout_respected()` ‚Äî OCR –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è –ø–æ —Ç–∞–π–º–∞—É—Ç—É, –Ω–µ –ø–∞–¥–∞–µ—Ç
   - `test_ocr_timeout_configurable()` ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä `OCR_TIMEOUT_PER_PAGE` –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è
   
2. **–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–∫–æ—Ä–æ—Å—Ç–∏ (–≠—Ç–∞–ø 2):**
   - –§–∞–π–ª: `tests/test_pdf_text_extraction.py`
   - `test_pdfplumber_fast_path()` ‚Äî —Ç–µ–∫—Å—Ç–æ–≤—ã–π PDF –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–æ (<1—Å)
   - `test_ocr_not_triggered_for_text_pdf()` ‚Äî OCR –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö PDF
   
3. **–ü–æ—Ä—è–¥–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (–≠—Ç–∞–ø 3):**
   - –§–∞–π–ª: `tests/test_indexer_sorting.py`
   - `test_files_sorted_by_extension()` ‚Äî TXT –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è —Ä–∞–Ω—å—à–µ PDF
   - `test_large_pdf_processed_last()` ‚Äî —Ñ–∞–π–ª—ã >10MB –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–º–∏
   
4. **–ú–µ–Ω–µ–¥–∂–µ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (–≠—Ç–∞–ø 4):**
   - –§–∞–π–ª: `tests/test_index_status.py`
   - `test_status_endpoint_structure()` ‚Äî `/index_status` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–∞–ª–∏–¥–Ω—ã–π JSON
   - `test_status_during_indexing()` ‚Äî —Å—Ç–∞—Ç—É—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏
   
5. **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å (–≠—Ç–∞–ø 6):**
   - –§–∞–π–ª: `tests/test_atomic_indexing.py`
   - `test_atomic_write()` ‚Äî –∏–Ω–¥–µ–∫—Å –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `.tmp` ‚Üí `os.replace()`
   - `test_searcher_reads_valid_index()` ‚Äî Searcher –Ω–µ –≤–∏–¥–∏—Ç –ø–æ–ª—É–±–∏—Ç—ã–π –∏–Ω–¥–µ–∫—Å

### –ö–æ–º–∞–Ω–¥—ã –∑–∞–ø—É—Å–∫–∞
```bash
# –í—Å–µ –±—ã—Å—Ç—Ä—ã–µ —Ç–µ—Å—Ç—ã (–±–µ–∑ OCR)
pytest -m "not ocr" tests/

# –ü–æ–ª–Ω—ã–π –Ω–∞–±–æ—Ä (–≤–∫–ª—é—á–∞—è OCR, —Ç—Ä–µ–±—É–µ—Ç tesseract)
pytest tests/

# –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —ç—Ç–∞–ø
pytest tests/test_ocr_timeouts.py -v
```

---

## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ (–ø–æ —ç—Ç–∞–ø–∞–º)
- **–≠—Ç–∞–ø 1:** —Å—Ç–∞–±–∏–ª—å–Ω—ã–π OCR, —Ç–∞–π–º–∞—É—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç, –±–µ–∑ –ø–∞–¥–µ–Ω–∏–π, –≤—Å–µ –±–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ.
- **–≠—Ç–∞–ø 2:** —É—Å–∫–æ—Ä–µ–Ω–∏–µ –Ω–∞ —Å–∏–Ω—Ç–µ—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–µ—Å—Ç–∞—Ö, –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–π.
- **–≠—Ç–∞–ø 3:** –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤, —Ñ–∏–Ω–∞–ª—å–Ω—ã–π `_search_index.txt` –ø–æ–ª–Ω—ã–π –∏ –≤–∞–ª–∏–¥–Ω—ã–π.
- **–≠—Ç–∞–ø 4:** —Å—Ç–∞—Ç—É—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è, —Ñ–æ—Ä–º–∞—Ç JSON –≤–∞–ª–∏–¥–µ–Ω, UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏.
- **–≠—Ç–∞–ø 5:** –∫–∞—á–µ—Å—Ç–≤–æ OCR —É–ª—É—á—à–∞–µ—Ç—Å—è –Ω–∞ —Å–∏–Ω—Ç–µ—Ç–∏–∫–µ, graceful degradation —Ä–∞–±–æ—Ç–∞–µ—Ç.
- **–≠—Ç–∞–ø 6:** –∞—Ç–æ–º–∞—Ä–Ω–∞—è –∑–∞–ø–∏—Å—å –±–µ–∑ —Ä–µ–≥—Ä–µ—Å—Å–∏–π, —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∫ –æ—à–∏–±–∫–∞–º, –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —á—Ç–µ–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ.

---

## –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–±–µ–∑ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö –∞–ø–¥–µ–π—Ç–æ–≤)
- **–£–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è:** pytesseract, pdf2image, Pillow, pdfplumber, pypdf, pdfminer.six, PyMuPDF
- **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ:** opencv-python (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–µ–Ω, –¥–ª—è —ç—Ç–∞–ø–∞ 5)
- **–¢–µ—Å—Ç—ã:** pytest-timeout (—Ç–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞)

---

## –§–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç
–ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –≤—Å–µ—Ö —ç—Ç–∞–ø–æ–≤ –ø–æ–ª—É—á–∞–µ–º –ø–æ—ç—Ç–∞–ø–Ω—É—é —Å–∏—Å—Ç–µ–º—É OCR + –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –±–µ–∑ –ë–î, —Å –≤—ã—Å–æ–∫–æ–π —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å—é –∏ —Å–∫–æ—Ä–æ—Å—Ç—å—é, –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º—É—é —Å —Ç–µ–∫—É—â–µ–π –ª–æ–≥–∏–∫–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –í—Å–µ —Ç—è–∂—ë–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ ‚Äî —Ç–æ–ª—å–∫–æ –Ω–∞ —ç—Ç–∞–ø–µ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏; –ø–æ–∏—Å–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ —Ñ–∏–Ω–∞–ª—å–Ω–æ–º—É –∫–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω–æ–º—É `uploads/_search_index.txt`.

---

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å OCR:** –≤—Å–µ —Ç—è–∂—ë–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ç–æ–ª—å–∫–æ –≤ —Ñ–æ–Ω–æ–≤–æ–π –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏, –Ω–∏–∫–æ–≥–¥–∞ –≤ HTTP-—Ä—É—á–∫–∞—Ö.
- **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å:** gracefully degrade –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ tesseract/pdf2image ‚Äî –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å —Å –ª–æ–≥–æ–º, –Ω–µ –ø–∞–¥–∞—Ç—å.
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞—Ç—å –∫–æ–ª-–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü –¥–ª—è OCR (–¥–µ—Ñ–æ–ª—Ç 2), –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –º—É–ª—å—Ç–∏—Å—Ç—Ä–∞–Ω–∏—á–Ω—ã—Ö —Å–∫–∞–Ω–æ–≤ ‚Äî —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —è–≤–Ω–æ–º –ø–æ–≤—ã—à–µ–Ω–∏–∏ `max_pages_ocr`.
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:** –≤—Å–µ –æ—à–∏–±–∫–∏, —Ç–∞–π–º–∞—É—Ç—ã, –ø—Ä–æ–ø—É—Å–∫–∏ ‚Äî –≤ `logs/app.log` —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º (—Ñ–∞–π–ª, —Å—Ç—Ä–∞–Ω–∏—Ü–∞).
- **–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:** –≠—Ç–∞–ø 1 (—Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏—è) ‚Üí –≠—Ç–∞–ø 2 (—Å–∫–æ—Ä–æ—Å—Ç—å) ‚Üí –≠—Ç–∞–ø 4 (–ø—Ä–æ–≥—Ä–µ—Å—Å) ‚Üí –≠—Ç–∞–ø 6 (–∞—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å) ‚Üí –≠—Ç–∞–ø—ã 3,5 (–æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏).