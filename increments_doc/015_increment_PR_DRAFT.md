# PR (черновик): Завершение инкремента 015 — DB-first индексация и очистка

## Цель изменений
- Довести инкремент 015 до 100%: индексация и статус — через БД, UI/тексты — DB-first, легаси-файлы не используются.
- Добавить минимальные тесты для проверки storage_url и реиндексации при изменении файлов.

## Что изменилось (кратко)
- /index_status: полностью DB-first — количество документов, last_indexed_at, root_hash; прогресс групп берётся из index/status.json.
- /view_index: добавлена DB-сводка (documents, last_indexed_at, root_hash) без ломки подсветки.
- UI: удалены/исправлены упоминания «сводного файла»; статус теперь «Индекс (БД)».
- Тесты: добавлен smoke-тест storage_url + reindex (skip, если нет PostgreSQL), включён в pytest.ini.
- Документация: дописан раздел «Миграция промптов» в 015-increment-CLEAN.md.

## Файлы и модули
- webapp/routes/search.py — DB-сводка в /view_index; DB-first логика /index_status была внедрена ранее.
- static/js/script.js — текст подтверждения удаления в DB-first стиле.
- tests/test_db_index_storage_url_and_reindex.py — новый тест.
- pytest.ini — подключение нового теста.
- increments_doc/015-increment-CLEAN.md — добавлен раздел миграции промптов.
- increments_doc/015_increment_PR_DRAFT.md — этот файл.

## Риски и ограничения
- /view_index сохраняет диагностическую функцию просмотра группового файла, он может отсутствовать; DB-сводка добавлена безопасно (graceful degrade).
- Тест storage_url/reindex требует реальной PostgreSQL и USE_DATABASE=true — по умолчанию помечен skip.

## Как проверить
1) Запуск
   - Убедиться, что приложение стартует (см. README), открыть главную страницу.
2) Индексация
   - Нажать «Построить индекс», дождаться завершения групп.
   - /index_status должен показывать «Индекс (БД): готов» и количество документов.
3) Просмотр индекса
   - Открыть /view_index — вверху видна DB-сводка, подсветка терминов работает.
4) Тесты
   - По умолчанию: `pytest -q` — зелёный, один тест может быть skipped.
   - С PostgreSQL: выставить USE_DATABASE=true и DATABASE_URL=postgresql://…; повторить `pytest -q` — тест storage_url/reindex выполнится.

## Дополнительно
- В планах — окончательная чистка UI от ссылок на файловые артефакты и консолидация промптов в БД по отдельному PR.
